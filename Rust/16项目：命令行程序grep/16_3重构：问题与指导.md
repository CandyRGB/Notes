> <font face = "楷体">会当凌绝顶，一览众山小。</font>

### 目前程序存在的问题
1. 通常一个函数负责一个功能，显然我们的main函数承受了不可承受之重，再在main函数里写功能的话，它恐怕是吃不消，易读性与可修复性都会大大降低。
2. 我们目前的main函数中已经有了三个变量，随着main函数的增长，就需要引入更多的变量到作用域中，到时候将可能分不清每个变量的实际作用。
3. 错误信息只知道是读文件时出错，但并不知道更具体的错误。
4. 在程序中我们使用except处理错误，但是当用户没有指定足够的参数来运行程序，他们就会从 Rust 得到`index out of bounds`错误，而不是我们自己定义返回的错误信息。我们希望所有的错误处理都位于一处，这样将来的维护者在需要修改错误处理逻辑时就只需要考虑这一处代码。

### 二进制项目的关注分离
#### 业务逻辑与解析逻辑
##### 业务逻辑
业务逻辑是指软件系统中与业务需求相关的逻辑。它处理核心的业务操作和规则，比如数据的验证、计算、处理流程等。

##### 解析逻辑
解析逻辑是指软件系统中用于解析和处理输入数据的逻辑。这包括解析命令行参数、网络请求、文件内容等。解析逻辑的目的是将输入数据转换成软件可以理解和处理的格式。

##### 两者的区别
|       | 业务逻辑   | 解析逻辑  |
|:--    | :--       | :--      |
| 关注点 |实现业务需求|处理输入输出|
|变化频率|相对稳定    |频繁：适应不同的输入格式或接口变化|
|测试    |模拟业务场景|输入输出的正确性|

#### 二进制程序的关注分离的指导性原则
1. 将程序拆分成`main.rs`和`lib.rs`，将业务逻辑放入`lib.rs`中。
2. 当命令行解析逻辑比较小时，可以保留在`main.rs`中。
3. 当命令行解析开始变得复杂时，也同样将其从`main.rs`提取到`lib.rs`中。

经过这些过程之后保留在 main 函数中的责任应该被限制为：
1. 使用参数值调用命令行解析逻辑
2. 设置任何其他的配置
3. 调用`lib.rs`中的`run`函数（之后的业务核心）
4. 如果`run`返回错误，则处理这个错误